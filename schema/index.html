



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="RPC & event system for Python 3">
      
      
        <link rel="canonical" href="http://lightbus.org/schema/">
      
      
        <meta name="author" content="Adam Charnock">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.1">
    
    
      
        <title>Schema - Lightbus</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.78aab2dc.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#specifying-types" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://lightbus.org" title="Lightbus" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Lightbus
              </span>
              <span class="md-header-nav__topic">
                Schema
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/adamcharnock/lightbus/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Lightbus
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/adamcharnock/lightbus/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quick-start/" title="Quick start" class="md-nav__link">
      Quick start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../worked-example/" title="Worked example" class="md-nav__link">
      Worked example
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../typing/" title="Typing" class="md-nav__link">
      Typing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../apis/" title="APIs" class="md-nav__link">
      APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rpcs/" title="Remote prcedure calls" class="md-nav__link">
      Remote prcedure calls
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Schema
      </label>
    
    <a href="./" title="Schema" class="md-nav__link md-nav__link--active">
      Schema
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#specifying-types" title="Specifying types" class="md-nav__link">
    Specifying types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-data-types" title="Supported data types" class="md-nav__link">
    Supported data types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automatic-validation" title="Automatic validation" class="md-nav__link">
    Automatic validation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-configuration" title="Validation configuration" class="md-nav__link">
    Validation configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validate-bool-true" title="validate (bool) = true" class="md-nav__link">
    validate (bool) = true
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strict_validation-bool-false" title="strict_validation (bool) = false" class="md-nav__link">
    strict_validation (bool) = false
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-validation" title="Manual validation" class="md-nav__link">
    Manual validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-types" title="Complex types" class="md-nav__link">
    Complex types
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named-tuples" title="Named Tuples" class="md-nav__link">
    Named Tuples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataclasses" title="Dataclasses" class="md-nav__link">
    Dataclasses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classes" title="Classes" class="md-nav__link">
    Classes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-format" title="Schema format" class="md-nav__link">
    Schema format
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../transports/" title="Transports" class="md-nav__link">
      Transports
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../command-line-use/" title="Command line use" class="md-nav__link">
      Command line use
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../debugging/" title="Debugging" class="md-nav__link">
      Debugging
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#specifying-types" title="Specifying types" class="md-nav__link">
    Specifying types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-data-types" title="Supported data types" class="md-nav__link">
    Supported data types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automatic-validation" title="Automatic validation" class="md-nav__link">
    Automatic validation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation-configuration" title="Validation configuration" class="md-nav__link">
    Validation configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validate-bool-true" title="validate (bool) = true" class="md-nav__link">
    validate (bool) = true
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strict_validation-bool-false" title="strict_validation (bool) = false" class="md-nav__link">
    strict_validation (bool) = false
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-validation" title="Manual validation" class="md-nav__link">
    Manual validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-types" title="Complex types" class="md-nav__link">
    Complex types
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named-tuples" title="Named Tuples" class="md-nav__link">
    Named Tuples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataclasses" title="Dataclasses" class="md-nav__link">
    Dataclasses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classes" title="Classes" class="md-nav__link">
    Classes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-format" title="Schema format" class="md-nav__link">
    Schema format
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/adamcharnock/lightbus/edit/master/docs/schema.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Schema</h1>
                
                <p>Lightbus processes automatically generate and share schemas for their available APIs.
These schemes can be used to validate the following:</p>
<ul>
<li>Remote procedure call parameters</li>
<li>Remote procedure call return values</li>
<li>Event parameters</li>
</ul>
<p>These schemas are shared using the configured <code>SchemaTransprt</code> (Redis, by default).
Each Lightbus process will monitor for any schema changes.</p>
<h2 id="specifying-types">Specifying types<a class="headerlink" href="#specifying-types" title="Permanent link">&para;</a></h2>
<p>Lightbus will create a schema by inspecting the parameters
and <a href="https://docs.python.org/3/library/typing.html">type hints</a> of your APIs' events and procedures.</p>
<p>You can use the schema functionality without type hints, but the level of validation
provided will be limited to ensuring parameter names match what is expected.</p>
<p>Take the following API as an example:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">lightbus</span> <span class="k">import</span> <span class="n">Api</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Parameter</span>

<span class="k">class</span> <span class="nc">AuthApi</span><span class="p">(</span><span class="n">Api</span><span class="p">):</span>
    <span class="c1"># Here we specify event parameters in the long-form using Parameter().</span>
    <span class="c1"># This provides sufficient information for the schema to be generated</span>
    <span class="n">user_registered</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="p">(</span>
        <span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="n">Parameter</span><span class="p">(</span><span class="s1">&#39;is_admin&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">))</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;auth&#39;</span>

    <span class="c1"># We annotate check_password() with the apropriate types</span>
    <span class="k">def</span> <span class="nf">check_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">username</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">&#39;secret&#39;</span>
</pre></div>

<p>Create this in a <code>bus.py</code> and run:</p>
<div class="codehilite"><pre><span></span>$ lightbus dumpschema
</pre></div>

<p>This will dump out the auto-generated schema for the above API. See
<a href="#schema-format">schema format</a> (below) for example output.</p>
<h2 id="supported-data-types">Supported data types<a class="headerlink" href="#supported-data-types" title="Permanent link">&para;</a></h2>
<p>Lightbus maps Python types to JSON types. While Python-specific values can be sent using Lightbus,
these values will arrive in their JSON form. For example, if you send a <code>string</code> then a <code>string</code> will arrive.
However, if you send the <code>Decimal</code> value <code>3.124</code>, then you will receive the <code>string</code> value <code>3.124</code> instead.</p>
<p>The following types are reasonably interoperable:</p>
<table>
<thead>
<tr>
<th>Python type sent</th>
<th>JSON schema interpretation</th>
<th>Type received</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code></td>
<td><code>string</code></td>
<td><code>str</code></td>
</tr>
<tr>
<td><code>int</code>, <code>float</code></td>
<td><code>number</code></td>
<td><code>int</code>, <code>float</code></td>
</tr>
<tr>
<td><code>bool</code></td>
<td><code>boolean</code></td>
<td><code>bool</code></td>
</tr>
<tr>
<td><code>list</code>, <code>tuple</code></td>
<td><code>array</code></td>
<td><code>list</code></td>
</tr>
<tr>
<td><code>None</code></td>
<td><code>null</code></td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>dict</code>, <code>Mapping</code>, etc</td>
<td><code>object</code></td>
<td><code>dict</code></td>
</tr>
<tr>
<td><code>Mapping[str, ...]</code></td>
<td><code>object</code>, with <a href="https://spacetelescope.github.io/understanding-json-schema/reference/object.html#pattern-properties">pattern properties</a> set</td>
<td><code>dict</code></td>
</tr>
<tr>
<td><code>Tuple[A, B, C]</code></td>
<td><code>array</code> with <a href="https://spacetelescope.github.io/understanding-json-schema/reference/array.html#length">maxItems/minItems</a> and <a href="https://spacetelescope.github.io/understanding-json-schema/reference/array.html#tuple-validation">items</a> set.</td>
<td><code>list</code></td>
</tr>
</tbody>
</table>
<p>The following types will be successfully encoded and sent, but will arrive as their encoded equivalent:</p>
<table>
<thead>
<tr>
<th>Python type</th>
<th>JSON Schema type</th>
<th>Value arrives as</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bytes</code>, <code>Decimal</code>, <code>complex</code></td>
<td><code>string</code></td>
<td><code>str</code></td>
</tr>
<tr>
<td><code>datetime</code>, <code>date</code></td>
<td><code>str</code></td>
<td><code>str</code> (ISO 8601)</td>
</tr>
<tr>
<td><code>NamedTuple</code> with annotations</td>
<td><code>object</code> with <a href="https://spacetelescope.github.io/understanding-json-schema/reference/object.html#properties">specific typed properties</a></td>
<td><code>dict</code></td>
</tr>
<tr>
<td><code>object</code> with annotations</td>
<td><code>object</code> with <a href="https://spacetelescope.github.io/understanding-json-schema/reference/object.html#properties">specific typed properties</a></td>
<td><code>dict</code></td>
</tr>
</tbody>
</table>
<p>Lightbus can also handle the following:</p>
<table>
<thead>
<tr>
<th>Python type</th>
<th>JSON Schema type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Any</code></td>
<td><code>{}</code> (any value)</td>
</tr>
<tr>
<td><code>Union[...]</code></td>
<td><code>oneOf{...}</code> (see <a href="https://spacetelescope.github.io/understanding-json-schema/reference/combining.html#oneof">oneOf</a>)</td>
</tr>
<tr>
<td><code>Enum</code></td>
<td>Sets <a href="https://spacetelescope.github.io/understanding-json-schema/reference/generic.html#enumerated-values">enum</a> property</td>
</tr>
</tbody>
</table>
<h2 id="automatic-validation">Automatic validation<a class="headerlink" href="#automatic-validation" title="Permanent link">&para;</a></h2>
<p>By default this validation will be validated in both the
incoming and outgoing directions. Outgoing refers to
the dispatching of events or procedure calls to the bus.
Incoming refers to the processing of procedure calls or
handling of received events.</p>
<p>You can configuring this using the <code>validate</code>
<a href="../configuration/">configuration</a> option.</p>
<h3 id="validation-configuration">Validation configuration<a class="headerlink" href="#validation-configuration" title="Permanent link">&para;</a></h3>
<p>You can configure the validation behaviour in your
bus' <code>config.yaml</code>.</p>
<h4 id="validate-bool-true"><code>validate (bool) = true</code><a class="headerlink" href="#validate-bool-true" title="Permanent link">&para;</a></h4>
<p>You can enable/disable validation using a boolean true/false flag:</p>
<div class="codehilite"><pre><span></span><span class="c1"># In config.yaml</span>
<span class="nv">apis:</span>
    <span class="nv">default:</span>
        <span class="nv">validate: </span><span class="kc">false</span>
</pre></div>

<p>For finer grained control you can specify individual flags for incoming/outgoing
validation:</p>
<div class="codehilite"><pre><span></span><span class="c1"># In config.yaml</span>
<span class="nv">apis:</span>
    <span class="nv">default:</span>
        <span class="nv">validate:</span>
          <span class="nv">outgoing: </span><span class="kc">true</span>
          <span class="nv">incoming: </span><span class="kc">false</span>
</pre></div>

<h4 id="strict_validation-bool-false"><code>strict_validation (bool) = false</code><a class="headerlink" href="#strict_validation-bool-false" title="Permanent link">&para;</a></h4>
<p>If <code>strict_validation</code> is <code>true</code> then calling a procedure for which no schema exists will
result in an error:</p>
<div class="codehilite"><pre><span></span><span class="c1"># In config.yaml</span>
<span class="nv">apis:</span>
    <span class="nv">default:</span>
        <span class="nv">strict_validation: </span><span class="kc">true</span>
</pre></div>

<h2 id="manual-validation">Manual validation<a class="headerlink" href="#manual-validation" title="Permanent link">&para;</a></h2>
<p>TODO</p>
<h2 id="complex-types">Complex types<a class="headerlink" href="#complex-types" title="Permanent link">&para;</a></h2>
<p>The Lightbus can derive a schema from both named tuples and classes.</p>
<h3 id="named-tuples">Named Tuples<a class="headerlink" href="#named-tuples" title="Permanent link">&para;</a></h3>
<p>Take the following <code>User</code> named tuple:</p>
<div class="codehilite"><pre><span></span><span class="c1"># bus.py</span>
<span class="kn">from</span> <span class="nn">lightbus</span> <span class="kn">import</span> <span class="n">Api</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">is_admin</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">class</span> <span class="nc">AuthApi</span><span class="p">(</span><span class="n">Api</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;auth&#39;</span>

    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">...</span>
</pre></div>

<p>Running <code>lightbus dumpschema</code> will produce the following:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;auth&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;events&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="nt">&quot;rpcs&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;get_user&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="err">//</span> <span class="err">A</span> <span class="err">single</span> <span class="err">required</span> <span class="err">username</span> <span class="err">string</span> <span class="err">parameter</span>
          <span class="nt">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="p">,</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;RPC auth.get_user() parameters&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span>
          <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">}</span>
          <span class="p">},</span>
          <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;username&quot;</span>
          <span class="p">],</span>
        <span class="p">},</span>

        <span class="err">//</span> <span class="err">A</span> <span class="err">complex</span> <span class="err">object</span> <span class="err">is</span> <span class="err">returned</span>
        <span class="nt">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="p">,</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;RPC auth.get_user() response&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
          <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;is_admin&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">],</span>
          <span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3 id="dataclasses">Dataclasses<a class="headerlink" href="#dataclasses" title="Permanent link">&para;</a></h3>
<p><a href="https://www.python.org/dev/peps/pep-0557/">Dataclasses</a>
were introduced in Python 3.7, with a
<a href="https://pypi.org/project/dataclasses/">backport available</a> for
Python 3.6.</p>
<p>Lightbus supports dataclasses in the same way as it supports
<a href="#named-tuples">named tuples</a>. For example:</p>
<div class="codehilite"><pre><span></span><span class="c1"># bus.py</span>
<span class="kn">from</span> <span class="nn">lightbus</span> <span class="k">import</span> <span class="n">Api</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="k">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">is_admin</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span> <span class="nc">AuthApi</span><span class="p">(</span><span class="n">Api</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;auth&#39;</span>

    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">...</span>
</pre></div>

<h3 id="classes">Classes<a class="headerlink" href="#classes" title="Permanent link">&para;</a></h3>
<p>The same can be achieved using regular classes. However, there are some notable points:</p>
<ol>
<li>Attributes prefixed with an underscore will be ignored</li>
<li>If used as a type hint for a parameter, then the class .... wait, will a json object get deserialised into a python object?
   NO, this only happens in the config. I think you'll just get a dict for a parameter value
TODO</li>
</ol>
<div class="codehilite"><pre><span></span><span class="nx">from</span> <span class="nx">lightbus</span> <span class="nx">import</span> <span class="nx">Api</span>


<span class="k">class</span> <span class="nx">User</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="o">:</span>
    <span class="nv">username: </span><span class="nx">str</span>
    <span class="nv">name: </span><span class="nx">str</span>
    <span class="nv">email: </span><span class="nx">str</span>
    <span class="nv">is_admin: bool = </span><span class="nx">False</span>
    <span class="c1"># private attributes are ignored</span>
    <span class="nv">_internal_value: str = </span><span class="s">&#39;&#39;</span>

    <span class="nx">def</span> <span class="nx">do_something</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">pass</span>

<span class="k">class</span> <span class="nx">AuthApi</span><span class="p">(</span><span class="nx">Api</span><span class="p">)</span><span class="o">:</span>

    <span class="k">class</span> <span class="nv">Meta:</span>
        <span class="nv">name = </span><span class="s">&#39;auth&#39;</span>

    <span class="nx">def</span> <span class="nx">get_user</span><span class="nf">(self, username: str) -&gt;</span> <span class="nv">User:</span>
        <span class="k">return</span> <span class="p">...</span>
</pre></div>

<h2 id="schema-format">Schema format<a class="headerlink" href="#schema-format" title="Permanent link">&para;</a></h2>
<p>You won't need to worry about the schema format in your day-to-day use
of Lightbus. However, an understanding of the format will be very
useful if you decide to build additional tooling.</p>
<p>The Lightbus schema format is simply a collection of child JSON Schemas.
Below is the schema for the example <code>auth</code> API shown above:</p>
<div class="codehilite"><pre><span></span><span class="err">//</span> <span class="err">Auto-generated</span> <span class="err">schema</span> <span class="err">for</span> <span class="err">auth</span> <span class="err">API</span>
<span class="p">{</span>
  <span class="nt">&quot;auth&quot;</span><span class="p">:</span> <span class="p">{</span>

    <span class="err">//</span> <span class="err">Events</span> <span class="err">specify</span> <span class="err">only</span> <span class="err">parameters</span>
    <span class="nt">&quot;events&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;user_registered&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="p">,</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Event auth.user_registered parameters&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">},</span>
          <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;is_admin&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;username&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span>
          <span class="p">],</span>
          <span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="err">//</span> <span class="err">RPCs</span> <span class="err">specify</span> <span class="err">both</span> <span class="err">parameters</span> <span class="err">and</span> <span class="err">response</span>
    <span class="nt">&quot;rpcs&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;check_password&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="p">,</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;RPC auth.check_password() parameters&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
          <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;username&quot;</span><span class="p">,</span>
            <span class="s2">&quot;password&quot;</span>
          <span class="p">],</span>
          <span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>

        <span class="nt">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="p">,</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;RPC auth.check_password() response&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The generalised format is as follows:</p>
<div class="codehilite"><pre><span></span><span class="err">//</span> <span class="err">Generalised</span> <span class="err">Lightbus</span> <span class="err">schema</span> <span class="err">format</span>
<span class="p">{</span>
  <span class="nt">&quot;&lt;api-name&gt;&quot;</span><span class="p">:</span> <span class="p">{</span>

    <span class="nt">&quot;events&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;&lt;event-name&gt;&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;parameters&quot;</span><span class="p">:</span>  <span class="p">{</span> <span class="err">/*</span> <span class="err">json</span> <span class="err">schema</span> <span class="err">*/</span> <span class="p">}</span>
      <span class="p">}</span>
      <span class="err">//</span> <span class="err">additional</span> <span class="err">events</span>
    <span class="p">},</span>

    <span class="nt">&quot;rpcs&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;&lt;rpc-name&gt;&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="err">/*</span> <span class="err">json</span> <span class="err">schema</span> <span class="err">*/</span> <span class="p">},</span>
        <span class="nt">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="err">/*</span> <span class="err">json</span> <span class="err">schema</span> <span class="err">*/</span> <span class="p">}</span>
      <span class="p">}</span>
      <span class="err">//</span> <span class="err">additional</span> <span class="err">procedures</span>
    <span class="p">}</span>

  <span class="p">}</span>
  <span class="err">//</span> <span class="err">additional</span> <span class="err">APIs</span>
<span class="p">}</span>
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lightbus will likely upgrade to a newer JSON Schema version once the <a href="https://github.com/Julian/jsonschema">jsonschema Python library</a> has the <a href="https://github.com/Julian/jsonschema/issues/337">requisite support</a>.</p>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../configuration/" title="Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Configuration
              </span>
            </div>
          </a>
        
        
          <a href="../transports/" title="Transports" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Transports
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.8eb9be28.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-103655163-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>